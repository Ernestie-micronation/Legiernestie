\RequirePackage{expl3}

\babelprovide[import=fr]{ernestien}
\babelfont[ernestien]{rm}{ErnestFont}
\babelfont[ernestien]{sf}{ErnestFont}
\babelfont[ernestien]{tt}{ErnestFont}
\setlocalecaption{ernestien}{preface}{mulinsecrî}
\setlocalecaption{ernestien}{ref}{etimolojî}
\setlocalecaption{ernestien}{abstract}{inbrêf}
\setlocalecaption{ernestien}{bib}{etimolojisekriî}
\setlocalecaption{ernestien}{chapter}{bukinplulâ}
\setlocalecaption{ernestien}{part}{poloniê}
\setlocalecaption{ernestien}{appendix}{poloniê}
\setlocalecaption{ernestien}{contents}{filmkujeperdû}
\setlocalecaption{ernestien}{listfigure}{mangajeperdû}
\setlocalecaption{ernestien}{listetable}{ekseljeperdû}
\setlocalecaption{ernestien}{index}{anulêr}
\setlocalecaption{ernestien}{figure}{mangâ} 
\setlocalecaption{ernestien}{table}{eksêl}
\setlocalecaption{ernestien}{page}{jûr}
\setlocalecaption{ernestien}{see}{rienâ}
\setlocalecaption{ernestien}{proof}{margê}

\setcase{ernestien}{datetime}{month1 = bakukû}
\setcase{ernestien}{datetime}{month2 = jakukû}
\setcase{ernestien}{datetime}{month3 = nakukû}
\setcase{ernestien}{datetime}{month4 = makukû}
\setcase{ernestien}{datetime}{month5 = hakukû}
\setcase{ernestien}{datetime}{month6 = dakukû}
\setcase{ernestien}{datetime}{month7 = kakukû}
\setcase{ernestien}{datetime}{month8 = fakukû}
\setcase{ernestien}{datetime}{month9 = takukû}
\setcase{ernestien}{datetime}{month10 = zakukû}
\setcase{ernestien}{datetime}{month11 = pakukû}
\setcase{ernestien}{datetime}{month12 = rakukû}

\ExplSyntaxOn
\cs_new:Nn \nathan_to_base_thirteen:n {
  \int_compare:nTF { #1 < 13 }
  { \nathan_map_digit:n {#1} }
  {
    \nathan_to_base_thirteen:n{
      \int_div_truncate:nn {#1} {13}
    }
    \nathan_map_digit:n{
      \int_mod:nn {#1} {13}
    }
  }
}

\cs_new:Nn \nathan_map_digit:n{
  \int_case:nn {#1} {
    {10} {X}
    {11} {Y}
    {12} {W}
  } [ #1 ] 
}

\newcommand{\baseTreize}[1]{
  \exp_args:Nx
  \nathan_to_base_thirteen:n
  { \values{#1}}
}
\ExplSyntaxOff

\addto\extrasernestien{
  \renewcommand{\thesection}{\baseTreize{section}}
  \renewcommand{\thesubsection}{\baseTreize{subsection}}
  \renewcommand{\thepage}{\baseTreize{page}}
  \renewcommand{\theequation}{\baseTreize{equation}}
  \renewcommand{\thefigure}{\baseTreize{figure}}
  \renewcommand{\thetable}{\baseTreize{table}}
  \renewcommand{\thefootnote}{\baseTreize{footnote}}
}
\addto\extrasfrench{
  \renewcommand{\thesection}{\arabic{section}}
  \renewcommand{\thesubsection}{\arabic{subsection}}
  \renewcommand{\thepage}{\arabic{page}}
  \renewcommand{\theequation}{\arabic{equation}}
  \renewcommand{\thefigure}{\arabic{figure}}
  \renewcommand{\thetable}{\arabic{table}}
  \renewcommand{\thefootnote}{\arabic{footnote}}
}
\addto\extrasenglish{
  \renewcommand{\thesection}{\arabic{section}}
  \renewcommand{\thesubsection}{\arabic{subsection}}
  \renewcommand{\thepage}{\arabic{page}}
  \renewcommand{\theequation}{\arabic{equation}}
  \renewcommand{\thefigure}{\arabic{figure}}
  \renewcommand{\thetable}{\arabic{table}}
  \renewcommand{\thefootnote}{\arabic{footnote}}
}
\addto\extrasesperanto{
  \renewcommand{\thesection}{\arabic{section}}
  \renewcommand{\thesubsection}{\arabic{subsection}}
  \renewcommand{\thepage}{\arabic{page}}
  \renewcommand{\theequation}{\arabic{equation}}
  \renewcommand{\thefigure}{\arabic{figure}}
  \renewcommand{\thetable}{\arabic{table}}
  \renewcommand{\thefootnote}{\arabic{footnote}}
}

\addto\captionsernestien{
  \renewcommand{\today}{
    \baseTreize{day}~\ifcase\month\or
      bakukû\or
      jakukû\or
      nakukû\or
      makukû\or
      hakukû\or
      dakukû\or
      kakukû\or
      fakukû\or
      takukû\or
      zakukû\or
      pakukû\or
      rakukû\fi~\baseTreize{year}
  }
}
